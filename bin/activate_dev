# Check if this file is being sourced
if [[ "${BASH_SOURCE[0]}" == "$0" ]]; then
  echo 'Error: this script must be sourced' > /dev/stderr
  exit 1
fi

if [[ -n "${JOURNALLER_DEV+x}" ]]; then
  echo 'Reloading development environment...'
  deactivate_dev
else
  echo 'Activating development environment...'
fi

deactivate_dev() {
  export PS1="$(echo $PS1 | sed -s 's/(journaller dev) //')"
  unset JOURNALLER_DEV JOURNALLER_CONFIG_PATH

  complete -r journaller
  unset -f journaller

  [[ -f ~/.journaller/bin/include ]] && . ~/.journaller/bin/include
}

export PS1="(journaller dev) $PS1"
export JOURNALLER_DEV=1
export JOURNALLER_CONFIG_PATH=".journallerrc_dev"

complete -r journaller
unset -f journaller

. $(dirname $BASH_SOURCE)/../lib/_autocomplete
journaller() {
  JOURNALLER_COMMAND="journaller" "$(dirname $BASH_SOURCE)/journaller" "$@"
}

